'''
解析工具类
解析的数据形式： ['00001011', '00110000', '10000010', '00000001', '11110011', '10100000', '00000011', '00000010']
加一个读取文件的函数 用来向dump输入文件
加一个保存的函数
最后再加一个可视化的函数
'''
class DERdumper(object):
    def getTag(self, datastr, index):
        # global tag_str_signbit
        tag_str = datastr[index]  # 获取数据列表中第一个元素 即tag
        tag_str_signbit = tag_str[2]  # 标志位
        tag_stru = tag_str[3:]
        '''
        判断该tag是什么数据类型
        '''
        if tag_stru == '00001':
            type = 'boolean'
        elif tag_stru == '00010':
            type = 'INTER'
        elif tag_stru == '00011':
            type = 'BIT STRING'
        elif tag_stru == '00100':
            type = 'OCTET STRING'
        elif tag_stru == '00110':
            type = 'NULL'
        elif tag_stru == '00110':
            type = 'OBJECT IDENTIFIER'
        elif tag_stru == '01000':
            type = 'OBJECT DESCRIPTOP'
        elif tag_stru == '01001':
            type = 'EXTERNAL'
        elif tag_stru == '01010':
            type = 'REAL'
        elif tag_stru == '01011':
            type = 'ENUMERATED'
        elif tag_stru == '01100':
            type = 'UTF8STRING'
        elif tag_stru == '01101':
            type = 'RELATIVE-OID'
        elif tag_stru == '01110':
            type = 'SEQUENCE'
        elif tag_stru == '01111':
            type = 'SET'
        elif tag_stru == '10000':
            type = 'NUMERICSTRING'
        elif tag_stru == '10001':
            type = 'PRINATBLESTRING'
        elif tag_stru == '10010':
            type = 'TELETESTRING'
        elif tag_stru == '10011':
            type = 'VIDEOSTRING'
        elif tag_stru == '10100':
            type = 'IA5STRING'
        elif tag_stru == '10101':
            type = 'UTCTime'
        elif tag_stru == '10110':
            type = 'GeneralizedTime'
        elif tag_stru == '10111':
            type = 'GraphicString'
        elif tag_stru == '11000':
            type = 'VisibleString, ISO646String'
        elif tag_stru == '11001':
            type = 'GeneralString'
        elif tag_stru == '11010':
            type = 'UniversalString'
        elif tag_stru == '11011':
            type = 'CHARACTER STRING'
        elif tag_stru == '11100':
            type = 'BMPString'
        return tag_str, tag_str_signbit

    def isConstrued(self,datastr,index):
        '''
        判断是否为嵌套结构
        :return:
        '''
        tag_str_signbit = datastr[index][2]
        if tag_str_signbit == '1':
            return  True
        else:
            return False
    @staticmethod
    def getLength(datastr,index):
        '''
        获取length的值和value的长度
        :param datastr:
        :return:
        '''

          # 元素计数器

        length_str = datastr[index]  # length字段首字节
        length_str_signbit = length_str[0]
        if length_str_signbit == '0':
            '''
            判断length字段有几个字节和长度
            如果标志位为0，length_str就是length字段的值，如果标志位为1，需要再判断获取整个length字段的值和长度
            '''
            Len_len = 1  # 标志位为0时，length字段的字节数
            Len_value = length_str  # length的值
            full_len_value = int(Len_value, 2)  # value值的长度
        elif length_str_signbit == '1':
            Len_len = int(length_str[1:], 2)  # length字段标志位为1时，首先获取length字段本身的长度
            Len_value = datastr[index + 1:index + Len_len + 1]  # length字段的值
            value = ''  # 中间变量 将Len_value中的元素拼接起来成为一整个元素
            for i in range(0, len(Len_value)):
                value = value + Len_value[i]
            full_len_value = int(value, 2)  # value值的长度
        return full_len_value, Len_len

    # @staticmethod
    # def getvaluelength():
    #     tup = DERdumper.getLength()
    #     return tup[0]
    def getValue(self, datastr,index):
        tup = DERdumper().getLength(datastr,index)

        value = datastr[tup[1] + 1:tup[0] + 1]
        # ret = DERdumper.isConstrued(self)
        # if ret:
        #     DERdumper.getValue(self,value)
        return value
der = DERdumper
def dump(data):
    valuelst = []
    index = 0
    while index < len(data) - 1:
        # tlvenity = tlv
        ret = der().isConstrued(data,index)  # 判断是否为嵌套结构
        # 解析tag
        tagtup = der().getTag(data, index)
        print(tagtup[0])
        index = index + 1
        # 解析length
        lengthtup = der().getLength(data, index)
        print(lengthtup[0])
        index = index + lengthtup[1]
        # 解析value
        value = data[index:lengthtup[0] + 1]
        print(value)
        if ret:
            dump(value)
        else:
            valuelst.append(value)
        index = index + lengthtup[0]





# data = ['00110000', '10000010', '00000110', '00110110', '00110000', '10000010', '00000101', '00011110', '10100000', '00000011', '00000010', '00000001', '00000010', '00000010', '00010000', '00000111', '10011100', '01010010', '11111101', '00001100', '01001011', '10011001', '11000110', '11001001', '01010101', '01100010', '11000101', '01011111', '00000100', '01101011', '01111101', '00110000', '00001101', '00000110', '00001001', '00101010', '10000110', '01001000', '10000110', '11110111', '00001101', '00000001', '00000001', '00001011', '00000101', '00000000', '00110000', '01011111', '00110001', '00001011', '00110000', '00001001', '00000110', '00000011', '01010101', '00000100', '00000110', '00010011', '00000010', '01010101', '01010011', '00110001', '00010101', '00110000', '00010011', '00000110', '00000011', '01010101', '00000100', '00001010', '00010011', '00001100', '01000100', '01101001', '01100111', '01101001', '01000011', '01100101', '01110010', '01110100', '00100000', '01001001', '01101110', '01100011', '00110001', '00011001', '00110000', '00010111', '00000110', '00000011', '01010101', '00000100', '00001011', '00010011', '00010000', '01110111', '01110111', '01110111', '00101110', '01100100', '01101001', '01100111', '01101001', '01100011', '01100101', '01110010', '01110100', '00101110', '01100011', '01101111', '01101101', '00110001', '00011110', '00110000', '00011100', '00000110', '00000011', '01010101', '00000100', '00000011', '00010011', '00010101', '01000111', '01100101', '01101111', '01010100', '01110010', '01110101', '01110011', '01110100', '00100000', '01000011', '01001110', '00100000', '01010010', '01010011', '01000001', '00100000', '01000011', '01000001', '00100000', '01000111', '00110001', '00110000', '00011110', '00010111', '00001101', '00110010', '00110000', '00110001', '00110000', '00110010', '00110000', '00110000', '00110000', '00110000', '00110000', '00110000', '00110000', '01011010', '00010111', '00001101', '00110010', '00110001', '00110001', '00110001', '00110010', '00110000', '00110010', '00110011', '00110101', '00111001', '00110101', '00111001', '01011010', '00110000', '01101011', '00110001', '00001011', '00110000', '00001001', '00000110', '00000011', '01010101', '00000100', '00000110', '00010011', '00000010', '01000011', '01001110', '00110001', '00010010', '00110000', '00010000', '00000110', '00000011', '01010101', '00000100', '00001000', '00001100', '00001001', '11100101', '10001100', '10010111', '11100100', '10111010', '10101100', '11100101', '10111000', '10000010', '00110001', '00110011', '00110000', '00110001', '00000110', '00000011', '01010101', '00000100', '00001010', '00001100', '00101010', '11100101', '10001100', '10010111', '11100100', '10111010', '10101100', '11100101', '10001000', '10011011', '11100110', '10010110', '10110000', '11100100', '10111001', '10010000', '11100111', '10011111', '10100101', '11100100', '10111111', '10100001', '11100110', '10000001', '10101111', '11100110', '10001010', '10000000', '11100110', '10011100', '10101111', '11100110', '10011100', '10001001', '11101001', '10011001', '10010000', '11100101', '10000101', '10101100', '11100101', '10001111', '10111000', '00110001', '00010011', '00110000', '00010001', '00000110', '00000011', '01010101', '00000100', '00000011', '00001100', '00001010', '00101010', '00101110', '01100011', '01110011', '01100100', '01101110', '00101110', '01101110', '01100101', '01110100', '00110000', '10000010', '00000001', '00100010', '00110000', '00001101', '00000110', '00001001', '00101010', '10000110', '01001000', '10000110', '11110111', '00001101', '00000001', '00000001', '00000001', '00000101', '00000000', '00000011', '10000010', '00000001', '00001111', '00000000', '00110000', '10000010', '00000001', '00001010', '00000010', '10000010', '00000001', '00000001', '00000000', '11010010', '00100000', '11010110', '10111100', '11111001', '01011011', '10110100', '01011100', '01101010', '11101010', '10001010', '01110001', '01110001', '00001011', '00011000', '10000010', '10011000', '10001000', '10100011', '10000011', '11000111', '10000100', '10011000', '11100010', '00111100', '01001111', '00101101', '11011010', '00110001', '10011000', '11010011', '00101000', '01001001', '00001111', '10001110', '00010001', '11010111', '01101010', '10011110', '10000111', '00111001', '01111000', '10111101', '01010111', '10001111', '01101110', '10110101', '11111011', '00000001', '01011100', '00111101', '01010000', '11001101', '11001111', '01100011', '11001110', '11001000', '01001111', '01000011', '10110101', '10101011', '11101001', '00111101', '10010100', '11100010', '01100011', '00110111', '01011000', '01101111', '01010001', '01100111', '00011111', '00101100', '10101101', '11110011', '01100000', '10000101', '11101100', '01011101', '00111010', '10110100', '10011110', '00011010', '11101110', '10101101', '11011100', '11010110', '10100111', '11111001', '11011001', '11110010', '10000110', '10000001', '01101001', '10111101', '10111110', '10101011', '11111110', '01001111', '10100101', '11101101', '01001000', '11010010', '00000100', '10010010', '01010010', '11011000', '11010010', '10010011', '10101111', '11110100', '10100110', '10011100', '11110101', '01110011', '01110010', '01000000', '11111110', '00111101', '10011000', '00111011', '11110100', '10111100', '00010010', '10001010', '00110011', '10100010', '10100001', '00001110', '10101100', '00011100', '10111100', '01001010', '10111000', '01001000', '01100101', '01001011', '01000110', '00001010', '11010100', '00010011', '11000001', '00110110', '11001110', '01110100', '10110010', '00110010', '10101110', '00100001', '01011101', '11011010', '01011111', '10111010', '01101010', '10000110', '10111011', '10010001', '11100001', '11000010', '00001111', '00110100', '00110100', '00001001', '10111000', '00101011', '11111010', '01000011', '00110000', '11000011', '10010111', '00011101', '00100001', '01000000', '10001001', '01000011', '00110000', '10011111', '10111011', '00110110', '01111111', '10110101', '10111001', '01001001', '00101010', '00010011', '01111100', '00011100', '00001111', '01110010', '01101011', '01101010', '11000010', '01100001', '00110011', '00100010', '00001000', '01010101', '01100011', '00000001', '10101010', '01011101', '11011000', '10001111', '01110101', '10000001', '11101100', '10101010', '01010111', '11000010', '01001101', '10111000', '00101001', '11000100', '11000011', '00001001', '11011011', '00111000', '00111000', '11011110', '10101010', '10110000', '01101001', '01111101', '10001111', '01010010', '00000001', '00111010', '00101000', '01000101', '11001101', '11100000', '00001111', '01001000', '11001010', '00100010', '01110010', '00111101', '00001001', '10001110', '10000011', '10100011', '11110110', '10110010', '00000110', '01011110', '00111111', '11001110', '00101011', '00001010', '11010111', '10111101', '01001001', '01110000', '00111000', '00001110', '11101101', '00000010', '00000011', '00000001', '00000000', '00000001', '10100011', '10000010', '00000010', '11100000', '00110000', '10000010', '00000010', '11011100', '00110000', '00011111', '00000110', '00000011', '01010101', '00011101', '00100011', '00000100', '00011000', '00110000', '00010110', '10000000', '00010100', '10010001', '10011111', '01011110', '00110001', '00010101', '10101110', '00010000', '10011111', '10101101', '01100000', '11000001', '11110111', '11000001', '11001100', '10101010', '01001000', '00110100', '00101111', '00001100', '00100110', '00110000', '00011101', '00000110', '00000011', '01010101', '00011101', '00001110', '00000100', '00010110', '00000100', '00010100', '01010010', '01010101', '01001111', '10111110', '10011001', '10001011', '10101000', '00011010', '11011010', '01000001', '00001010', '00011000', '00010100', '00011010', '00100110', '11101000', '01101000', '00001001', '00101100', '10010011', '00110000', '00011111', '00000110', '00000011', '01010101', '00011101', '00010001', '00000100', '00011000', '00110000', '00010110', '10000010', '00001010', '00101010', '00101110', '01100011', '01110011', '01100100', '01101110', '00101110', '01101110', '01100101', '01110100', '10000010', '00001000', '01100011', '01110011', '01100100', '01101110', '00101110', '01101110', '01100101', '01110100', '00110000', '00001110', '00000110', '00000011', '01010101', '00011101', '00001111', '00000001', '00000001', '11111111', '00000100', '00000100', '00000011', '00000010', '00000101', '10100000', '00110000', '00011101', '00000110', '00000011', '01010101', '00011101', '00100101', '00000100', '00010110', '00110000', '00010100', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00000011', '00000001', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00000011', '00000010', '00110000', '01110101', '00000110', '00000011', '01010101', '00011101', '00011111', '00000100', '01101110', '00110000', '01101100', '00110000', '00110100', '10100000', '00110010', '10100000', '00110000', '10000110', '00101110', '01101000', '01110100', '01110100', '01110000', '00111010', '00101111', '00101111', '01100011', '01110010', '01101100', '00110011', '00101110', '01100100', '01101001', '01100111', '01101001', '01100011', '01100101', '01110010', '01110100', '00101110', '01100011', '01101111', '01101101', '00101111', '01000111', '01100101', '01101111', '01010100', '01110010', '01110101', '01110011', '01110100', '01000011', '01001110', '01010010', '01010011', '01000001', '01000011', '01000001', '01000111', '00110001', '00101110', '01100011', '01110010', '01101100', '00110000', '00110100', '10100000', '00110010', '10100000', '00110000', '10000110', '00101110', '01101000', '01110100', '01110100', '01110000', '00111010', '00101111', '00101111', '01100011', '01110010', '01101100', '00110100', '00101110', '01100100', '01101001', '01100111', '01101001', '01100011', '01100101', '01110010', '01110100', '00101110', '01100011', '01101111', '01101101', '00101111', '01000111', '01100101', '01101111', '01010100', '01110010', '01110101', '01110011', '01110100', '01000011', '01001110', '01010010', '01010011', '01000001', '01000011', '01000001', '01000111', '00110001', '00101110', '01100011', '01110010', '01101100', '00110000', '01001100', '00000110', '00000011', '01010101', '00011101', '00100000', '00000100', '01000101', '00110000', '01000011', '00110000', '00110111', '00000110', '00001001', '01100000', '10000110', '01001000', '00000001', '10000110', '11111101', '01101100', '00000001', '00000001', '00110000', '00101010', '00110000', '00101000', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00000010', '00000001', '00010110', '00011100', '01101000', '01110100', '01110100', '01110000', '01110011', '00111010', '00101111', '00101111', '01110111', '01110111', '01110111', '00101110', '01100100', '01101001', '01100111', '01101001', '01100011', '01100101', '01110010', '01110100', '00101110', '01100011', '01101111', '01101101', '00101111', '01000011', '01010000', '01010011', '00110000', '00001000', '00000110', '00000110', '01100111', '10000001', '00001100', '00000001', '00000010', '00000010', '00110000', '01101111', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00000001', '00000001', '00000100', '01100011', '00110000', '01100001', '00110000', '00100001', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00110000', '00000001', '10000110', '00010101', '01101000', '01110100', '01110100', '01110000', '00111010', '00101111', '00101111', '01101111', '01100011', '01110011', '01110000', '00101110', '01100100', '01100011', '01101111', '01100011', '01110011', '01110000', '00101110', '01100011', '01101110', '00110000', '00111100', '00000110', '00001000', '00101011', '00000110', '00000001', '00000101', '00000101', '00000111', '00110000', '00000010', '10000110', '00110000', '01101000', '01110100', '01110100', '01110000', '00111010', '00101111', '00101111', '01100011', '01110010', '01101100', '00101110', '01100100', '01101001', '01100111', '01101001', '01100011', '01100101', '01110010', '01110100', '00101101', '01100011', '01101110', '00101110', '01100011', '01101111', '01101101', '00101111', '01000111', '01100101', '01101111', '01010100', '01110010', '01110101', '01110011', '01110100', '01000011', '01001110', '01010010', '01010011', '01000001', '01000011', '01000001', '01000111', '00110001', '00101110', '01100011', '01110010', '01110100', '00110000', '00001100', '00000110', '00000011', '01010101', '00011101', '00010011', '00000001', '00000001', '11111111', '00000100', '00000010', '00110000', '00000000', '00110000', '10000010', '00000001', '00000100', '00000110', '00001010', '00101011', '00000110', '00000001', '00000100', '00000001', '11010110', '01111001', '00000010', '00000100', '00000010', '00000100', '10000001', '11110101', '00000100', '10000001', '11110010', '00000000', '11110000', '00000000', '01110110', '00000000', '11110110', '01011100', '10010100', '00101111', '11010001', '01110111', '00110000', '00100010', '00010100', '01010100', '00011000', '00001000', '00110000', '10010100', '01010110', '10001110', '11100011', '01001101', '00010011', '00011001', '00110011', '10111111', '11011111', '00001100', '00101111', '00100000', '00001011', '11001100', '01001110', '11110001', '01100100', '11100011', '00000000', '00000000', '00000001', '01110101', '01000101', '00101110', '00010110', '11011100', '00000000', '00000000', '00000100', '00000011', '00000000', '01000111', '00110000', '01000101', '00000010', '00100000', '01010101', '11010101', '01110110', '01010100', '10110010', '11010010', '00010101', '10110011', '10010011', '10010100', '11110011', '10110001', '01100101', '10110001', '10100010', '11101001', '10100000', '00011110', '01101101', '01011100', '01111000', '01111000', '01000110', '01000111', '10110000', '01110011', '10100011', '01100011', '01001000', '10001100', '11100111', '11010000', '00000010', '00100001', '00000000', '11101011', '11100010', '11111110', '10011100', '10111110', '01111101', '11100011', '00011001', '00100111', '10111011', '00000011', '10010011', '01011110', '10101111', '11111100', '01010110', '10111110', '00101001', '11110100', '00001011', '01010110', '10000000', '01100100', '11001011', '11100010', '00010000', '00011011', '00111001', '00011111', '11001010', '11111010', '10101001', '00000000', '01110110', '00000000', '01011100', '11011100', '01000011', '10010010', '11111110', '11100110', '10101011', '01000101', '01000100', '10110001', '01011110', '10011010', '11010100', '01010110', '11100110', '00010000', '00110111', '11111011', '11010101', '11111010', '01000111', '11011100', '10100001', '01110011', '10010100', '10110010', '01011110', '11100110', '11110110', '11000111', '00001110', '11001010', '00000000', '00000000', '00000001', '01110101', '01000101', '00101110', '00010111', '00110001', '00000000', '00000000', '00000100', '00000011', '00000000', '01000111', '00110000', '01000101', '00000010', '00100001', '00000000', '11011100', '11001101', '00001100', '10001010', '10000111', '01110101', '00110111', '01111110', '11100011', '11011011', '00011001', '11011110', '10110100', '11011101', '10011111', '10001100', '01111001', '10110110', '10010100', '01110000', '01100101', '00000011', '01011100', '11011010', '10010100', '00001000', '11000110', '11100111', '11111001', '11100011', '10010001', '11111101', '00000010', '00100000', '00001010', '01110111', '10011010', '00111110', '10010001', '00001000', '11010010', '10110010', '10000110', '11110000', '10010011', '00011111', '10110111', '00110010', '01001000', '10011001', '11111110', '10101011', '10001110', '11010111', '00100000', '00010001', '01001000', '01101111', '10100110', '11100001', '00100101', '11000101', '10111001', '11001100', '10110111', '10110101', '00110000', '00001101', '00000110', '00001001', '00101010', '10000110', '01001000', '10000110', '11110111', '00001101', '00000001', '00000001', '00001011', '00000101', '00000000', '00000011', '10000010', '00000001', '00000001', '00000000', '00001001', '01011011', '00110100', '10110000', '11011000', '11101101', '00011011', '01110010', '01001100', '11000010', '11111011', '11110110', '10000000', '10001000', '10111110', '11110110', '10101111', '01111101', '00100100', '00101011', '00010111', '10110101', '01101000', '10010100', '01010010', '11000010', '11101100', '11010000', '01001110', '01100011', '01001010', '00100110', '00110100', '00101100', '11101001', '01100100', '01110101', '10101101', '00100001', '11100001', '00010010', '10000100', '01100101', '10010100', '10000110', '10000111', '01110000', '11111100', '11110001', '10110000', '11100010', '10011100', '00010110', '00010110', '11110001', '01000010', '00000001', '10011110', '11110010', '00010010', '10011110', '01000111', '01111101', '01001110', '00110100', '01010100', '11111111', '11101000', '10100001', '00110010', '11011010', '10111010', '11001010', '00110110', '11001101', '01001100', '10111011', '10011110', '01001010', '01011011', '10101111', '11001000', '01000000', '01110111', '01111000', '11001111', '10100111', '10110000', '00101101', '11001000', '11111100', '01111110', '01010110', '11010101', '01000100', '00111111', '01100010', '00010001', '10100010', '11000100', '00001100', '01111010', '10101101', '01010011', '01010101', '00101010', '01011101', '10000010', '11001110', '01101111', '11000000', '01111111', '11011110', '10011011', '01100111', '11010100', '11100101', '00001000', '10111101', '11011101', '00000111', '00111111', '10001101', '10101111', '10000001', '01110000', '01000110', '11011010', '10000001', '01100110', '01110111', '11011101', '11100000', '10111001', '01010111', '11010110', '01100110', '11101111', '11010110', '11100100', '11101001', '00101111', '01011111', '01010010', '01000010', '11010011', '10001100', '11010100', '11001000', '10111010', '10101000', '11000100', '10001101', '11010110', '11111100', '10110110', '11001100', '01111111', '01011100', '11111010', '01100100', '01001010', '00001101', '11000100', '00100001', '10010100', '01101010', '01111000', '01001100', '00111101', '11110000', '01000110', '11010111', '10001100', '10101010', '00111111', '10100000', '10100000', '10010101', '01101110', '00011010', '01100111', '11111000', '11001010', '10001001', '01011011', '10000010', '11010000', '10011001', '11110100', '11001111', '11100010', '10001001', '00100010', '00111000', '11110110', '11010111', '01000010', '00000001', '11010011', '10110101', '10111101', '01111010', '11111110', '00100010', '11111010', '11000101', '00010101', '11100010', '11000011', '01101111', '01001000', '01011001', '00110010', '10010101', '10111100', '11111011', '10110011', '10101010', '00111100', '10001111', '00001010', '10110101', '01101100', '01010001', '00001101', '00111000', '00100111', '11011111', '00001111', '11010111', '00101001', '11011110', '10100001', '11010011', '10111001', '01111110', '01110011', '01101111', '00001110', '00111110', '11101000', '11001001', '11100010', '01001111', '01101011', '01001101', '11100101', '01100000', '01101101', '11111100', '01111110', '01001100', '10110000', '11001101', '01101011']






